/* Dynamic Input Width jQuery Plugin v0.1 | github.com/hirokiosame/dynamicInputWidth */
$.fn.dynamicInputWidth=function(a){var c=this instanceof jQuery?this:$(this);if(!c.is("input"))return this;a=$.extend({returnWidth:!1,context:"body",placeholder:!0,useInputStyle:!0,minWidth:1,"class":"",css:{}},a);var b=c.val(),d=a.placeholder?c.attr("placeholder")||"":"";if(0===b.length+d.length)return c.width(a.minWidth),this;b=b.length>d.length?b:d;b=$("<span>",{"class":a["class"]}).css(jQuery.extend({width:"auto",visibility:"hidden",whiteSpace:"nowrap"},a.useInputStyle?c.css("font-size font-family font-weight font-style font-variant word-spacing letter-spacing text-indent text-rendering text-transform".split(" ")):{},a.css)).text(b).appendTo(a.context);d=b.width();b.remove();return a.returnWidth?d:c.width(d)};

/* VisualQuery.js v0.1 | github.com/hirokiosame/VisualQuery */
$.fn.search=function(c){var b=$("<div>",{"class":"parameters"});this.replaceWith($("<div>",{"class":"search"}).html(b));var e={},f=[];c=$.extend({strict:!1,parameters:[],defaultQuery:[],callback:$.noop()},c);var k=function(){var a=[];f.forEach(function(d){var b=d.toObj();b&&a.push(b);return d.toObj()});c.callback(a)};c.parameters.forEach(function(a){e[a.name]=a});var g=function(a,d){var b,c;return{$:$("<ul></ul>",{"class":"autoComplete"}).on("mouseover","li",function(){$(this).siblings(":has(.selected)").children("a").removeClass("selected"); $("a",this).addClass("selected")}).on("mousedown","a",function(a){a.preventDefault();b.val($(a.target).attr("value")).blur().next("input").focus()}).insertAfter(d),targetInput:function(a){b=$(a);return this},setLis:function(a){c=a;this.renderLis();return this},renderLis:function(){var d=!1;this.$.html(c.map(function(c){return c.match(b.val())?$("<a></a>",{"class":!0===a.strict&&!1===d&&(d=!0)?"selected":""}).attr("value",c).text(c).wrap("<li>").parent():!1}));this.padding=this.padding||parseInt(this.$.find("li>a").css("padding-left"))}, offset:function(a){this.$.offset({left:a-(this.padding||0)})}}}(c,b),h=function(a,d,c){this.name=$("<input>",{"class":"name",value:a}).dynamicInputWidth({context:b,"class":"name inputBlurred",useInputStyle:!1});this.operator=$("<input>",{"class":"operator",value:d}).dynamicInputWidth({context:b,"class":"inputBlurred",useInputStyle:!1});this.value=$("<input>",{"class":"value",value:c}).dynamicInputWidth({context:b,"class":"inputBlurred",useInputStyle:!1});this.$=$("<div>",{"class":"parameter"}).append('<div class="remove"></div>', this.name,this.operator,this.value);this.bind()};h.prototype.toObj=function(){return this.$.hasClass("error")||!this.$?!1:{name:this.name.val(),operator:this.operator.val(),value:this.value.val()}};h.prototype.remove=function(){var a=this;this.$.remove();f.every(function(d,b){return d.$.is(a.$)?(delete f[b],!1):!0});return k()};h.prototype.bind=function(){var a=this;this.$.on("click","div.remove",a.remove.bind(a)).on("blur","input",function(d){g.$.hide();if(0===a.name.val().length+a.operator.val().length+a.value.val().length)return a.remove();a.$.removeClass("error");if(0===a.name.val().length^(0<a.value.val().length&&0===a.operator.val().length)||c.strict&&(!e.hasOwnProperty(a.name.val())||0<a.operator.val().length&&-1===$.inArray(a.operator.val(),e[a.name.val()].operators)||0<a.value.val().length&&-1===$.inArray(a.value.val(),e[a.name.val()].values)))return a.$.addClass("error")}).on("focus","input",function(d){d=$(d.target);g.targetInput(d).setLis(d.is(a.name)?Object.keys(e):a.name.val()in e?e[a.name.val()][d.is(a.operator)?"operators":"values"]:[]);g.$.show();g.offset(d.offset().left)}).on("keydown","input",function(a){var b=$(a.target);13===a.keyCode&&(a=g.$.find(".selected"),1===a.length&&b.val(a.attr("value")),b.blur().next("input").focus())}).on("keyup","input",function(a){g.renderLis()})};c.defaultQuery.forEach(function(a){(!c.strict||a.name in e)&&f[f.push(new h(a.name,a.operator,a.value))-1].$.appendTo(b)});b.on("mousedown",function(a){if($(a.target).is(b)){a.preventDefault();$("div.parameter.selected",b).removeClass("selected");var d;$("div.parameter",b).each(function(){if($(this).offset().left>a.pageX)return d=$(this),!1});var c=f[f.push(new h)-1];void 0!==d?d.before(c.$):c.$.appendTo(this);c.$.find("input.name").focus().val("")}}).on("keydown keypress input","input",function(a){var d=$(a.target);"input"===a.type?d.dynamicInputWidth({context:b,"class":"inputFocused",useInputStyle:!1}):1<String.fromCharCode(a.which).length&&setTimeout(function(){d.dynamicInputWidth({context:b,"class":"inputFocused",useInputStyle:!1})},0)}).on("blur","input",function(a){a=$(this);a.dynamicInputWidth({context:b,"class":a.attr("class")+" inputBlurred",useInputStyle:!1});k()}).on("focus","input",function(a){a=$(this);a.dynamicInputWidth({context:b,"class":"inputFocused",useInputStyle:!1});a=a.parent("div.parameter");!a.hasClass("selected")&&$("div.parameter.selected",b).removeClass("selected")&&a.addClass("selected")}).on("mousedown","div.parameter",function(a){var d=$(this),c=$(a.target);if(!d.hasClass("selected"))return a.preventDefault(),$("input:focus",b).blur(),$("div.parameter.selected",b).removeClass("selected"),d.addClass("selected");if(c.is(d))return d.removeClass("selected")}).on("scroll",function(a){a=$("input:focus",b);if(1===a.length){var d=a.offset(),c=b.offset();d.left<c.left||d.left>c.left+b.width()-a.width()?g.$.hide(50):(g.$.show(100),g.offset(d.left))}})};