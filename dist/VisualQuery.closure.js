$.fn.focus=function(b,c){if(this[0]){if(1<=arguments.length&&Array.prototype.every.call(arguments,function(b){return Math.floor(b)===b&&$.isNumeric(b)})){if(this[0].setSelectionRange)return this[0].setSelectionRange(b,c||b);if(this[0].createTextRange){var d=this[0].createTextRange();d.collapse(!0);d.moveEnd("character",c||b);d.moveStart("character",b);d.select()}}else if(2===arguments.length)return this.on("focus",null,b,c);return this.trigger("focus")}};
$.fn.visualquery=function(b){b=$.extend({strict:!1,parameters:[],defaultQuery:[],callback:$.noop()},b);var c=$("<div>",{"class":"parameters"}),d={},g={names:[]};b.parameters.forEach(function(a){d[a.name]=a;g.names.push(a.name);g[a.name+"_operators"]=a.operators&&a.operators;g[a.name+"_values"]=a.values&&a.values});var k=function(){$("<ul></ul>");return{lis:function(a){},input:function(){},hide:function(){},show:function(){}}}(),h=function(a,l,m){var e=this;this.$=$("<div>",{"class":"parameter"}).append($("<span></span>",
{id:"remove",html:"&times;"}).on("click",function(){e.$.remove()}),this.name=$("<input>",{type:"text",spellcheck:"false",autocomplete:"off",id:"name",value:a,style:"width:1px;",list:"names"}),this.operator=$("<input>",{type:"text",spellcheck:"false",autocomplete:"off",id:"operator",value:l,style:"width:1px;"}),this.value=$("<input>",{type:"text",spellcheck:"false",autocomplete:"off",id:"value",value:m,style:"width:10px;"})).on("keydown","input",function(a){var b=$(a.target);13===a.keyCode&&b.next().focus()}).on("blur",
"input",function(a){}).on("input","input",function(a){a=$(this);var f=a.val(),e=0!==f.length?f:a.attr("placeholder")||"";console.log(f,f.length,a.attr("type"));f=$("<span>",{"class":b["class"]}).css(jQuery.extend({position:"absolute",width:"auto",visibility:"hidden",whiteSpace:"pre"},a.css("font-size font-family font-weight font-style font-variant word-spacing letter-spacing text-indent text-rendering text-transform".split(" ")))).text(e).appendTo(c);e=f.width();f.remove();a.width(e+({number:17,date:57}[a.attr("type")]||
0)+1+(void 0!==a.attr("list")?20:0));k.input()});this.name.on("focus",function(){console.log("Open autoComplete")}).on("blur",function(){var a=e.name.val(),c=d[a]||{};e.operator.attr(jQuery.extend({placeholder:""},c.operatorAttrs||{},{type:"text",list:a})).trigger("input");e.value.attr(jQuery.extend({type:"text",placeholder:""},c.valueAttrs||{},{type:c.type||c.valueAttrs&&c.valueAttrs.type||"text",list:a+"_values"})).trigger("input");if(b.strict&&!d.hasOwnProperty(a))return"Error"});this.value.on("blur",
function(){e.value[0].checkValidity()?e.$.removeClass("error"):e.$.addClass("error")})};b.defaultQuery.forEach(function(a){if(!b.strict||a.name in d)a=new h(a.name,a.operator,a.value,a.type),a.$.appendTo(c)});c.on("focusin",function(){c.addClass("selected")}).on("blur","input",function(){c.removeClass("selected")}).on("mousedown",function(a){if($(a.target).is(c)){a.preventDefault();$("div.parameter.selected",c).removeClass("selected");var b;$("div.parameter",c).each(function(){var c=$(this),d=c.offset();
if(d.top>a.pageY||d.top<a.pageY&&a.pageY<d.top+c.height()&&d.left>a.pageX)return!1;b=c});var d=new h;d.$[void 0!==b?"insertAfter":"prependTo"](b||this);d.name.focus()}});this.html(c)};
