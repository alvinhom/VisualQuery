(function e$$0(g,l,a){function b(e,c){if(!l[e]){if(!g[e]){var m="function"==typeof require&&require;if(!c&&m)return m(e,!0);if(f)return f(e,!0);m=Error("Cannot find module '"+e+"'");throw m.code="MODULE_NOT_FOUND",m;}m=l[e]={exports:{}};g[e][0].call(m.exports,function(q){var c=g[e][1][q];return b(c?c:q)},m,m.exports,e$$0,g,l,a)}return l[e].exports}for(var f="function"==typeof require&&require,c=0;c<a.length;c++)b(a[c]);return b})({1:[function(h,g,l){g.exports=function(){function a(b){this._=b}a.prototype.addClass=
function(b){b=b.split(" ");for(var f=0;f<b.length;f++)b[f]&&(this._.classList?this._.classList.add(b[f]):this._.className=b[f]);return this};a.prototype.removeClass=function(b){this._.classList?this._.classList.remove(b):this._.className=this._.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ");return this};a.prototype.hide=function(){"none"!==this._.style.display&&(this._.style.display="none");return this};a.prototype.show=function(){"block"!==this._.style.display&&
(this._.style.display="block");return this};a.prototype.shown=function(){return"none"!==this._.style.display};a.prototype.on=function(b,f,c){c=!!c;b=b.split(" ");for(var e=0,a=b.length;e<a;e++)this._.addEventListener(b[e],f,c);return this};a.prototype.off=function(b,a){b=b.split(" ");for(var c=0,e=b.length;c<e;c++)this._.removeEventListener(b[c],a);return this};a.prototype.one=function(b,a){var c=this;return this.on(b,function d(){c.off(b,d);a.apply(this,[].slice.apply(arguments))})};a.prototype.append=
function(b){for(var f=b instanceof Array?b:arguments,c=0,e=f.length;c<e;c++)this._.appendChild(f[c]instanceof a?f[c]._:f[c]);return this};a.prototype.replaceWith=function(b){b=b instanceof a?b._:b;this._.parentNode&&this._.parentNode.replaceChild(b,this._);this._=b;return this};a.prototype.text=function(b,a){var c=this.textWrap||this._;if(0===arguments.length)return c.textContent;c.textContent=(a?c.textContent:"")+b;return this};a.prototype.html=function(b,a){this._.innerHTML=(a?this._.innerHTML:
"")+b;return this};a.prototype.attr=function(b,a){if("string"!==typeof b)throw Error("An attribute name is required");if("string"!==typeof a)return this._.getAttribute(b);this._.setAttribute(b,a);return this};a.prototype.remove=function(){if(this._.parentNode)return this._.parentNode.removeChild(this._),this};a.prototype.offset=function(b,a){this._.style.top=b;this._.style.left=a;return this};a.prototype.css=function(b,a){if("string"===typeof b)if("string"===typeof a)this._.style[b]=a;else return getComputedStyle(this._)[b];
else if(b instanceof Object)for(var c in b)this._.style[c]=b[c];return this};a.prototype.trigger=function(b){b=new Event(b);this._.dispatchEvent(b);return this};a.prototype.prev=function(){if(this._.previousSibling)return new a(this._.previousSibling)};a.prototype.next=function(){if(this._.nextSibling)return new a(this._.nextSibling)};return function(b,f){if(b instanceof a)return b;var c=new a;if("string"===typeof b){if(c._=document.createElement(b),"object"===typeof f){var e=Object.create(f);"string"===
typeof e.textWrap&&(c.textWrap=document.createElement(e.textWrap),c._.appendChild(c.textWrap),e.textWrap=null);void 0!==e.text&&null!==f.text&&(c.text(e.text),e.text=null);"string"===typeof e.html&&(c.html(e.html),e.html=null);"string"===typeof e.class&&(c.addClass(e.class),e.class=null);for(var d in e)e[d]&&c._.setAttribute(d,e[d])}}else c._=b;return c}}()},{}],2:[function(h,g,l){g.exports=function(){function a(){this._events={}}a.prototype.emit=function(b){if(!this._events[b])return!1;var a=[].slice.apply(arguments,
[1]);this._events[b].forEach(function(b){b.apply(window,a)})};a.prototype.on=function(b,a){(this._events[b]||(this._events[b]=[])).push(a);return this};return a}()},{}],3:[function(h,g,l){g.exports=function(){function a(a,c){b.apply(this);this.name=a;this.$=f("input",{type:"text",spellcheck:"false",autoComplete:"off","class":a}).css("width","1px");c&&(this.$._.value=c);this.bindEvents()}var b=h("./EventEmitter"),f=h("./Element"),c=h("./inputResize");a.prototype=Object.create(b.prototype);a.prototype.toJSON=
function(){return this.$._.value};a.prototype.previewValue=function(b){this.$.attr("placeholder",b).trigger("input")};a.prototype.focus=function(b){"number"!==this.$._.type&&"number"===typeof b&&this.$._.setSelectionRange&&this.$._.setSelectionRange(b,b);this.$._.focus()};a.prototype.changeValue=function(b){b&&(this.$._.value=b);this.$.trigger("input").trigger("blur").trigger("change");this.emit("nextInput")};a.prototype.bindEvents=function(){var b=this;this.on("rendered",function(){b.$.trigger("input")});
this.$.on("focus",function(){b.emit("focus")}).on("blur",function(){b.emit("blur")}).on("change",function(){b.emit("change")}).on("keydown",function(a){0===this.selectionStart&&0===this.selectionEnd&&(37===a.keyCode||0===this.value.length&&8===a.keyCode)&&(a.preventDefault(),b.emit("prevInput"));this.value.length===this.selectionStart&&this.value.length===this.selectionEnd&&39===a.keyCode&&(a.preventDefault(),b.emit("nextInput"))}).on("input",c)};a.prototype.validate=function(){return 0===this.$.value.length?
!1:!0};return a}()},{"./Element":1,"./EventEmitter":2,"./inputResize":8}],4:[function(h,g,l){g.exports=function(){function a(b,a){d.apply(this);this.collection=b;a=a||{};this.name=new e("name",a.name);this.operator=new e("operator",a.operator);this.value=new e("value",a.value);var c=m("span",{"class":"remove",html:"&times;"}).on("click",this.emit.bind(this,"remove"));this.$=m("div",{"class":"parameter"}).append(c,this.name.$,this.operator.$,this.value.$);this.bindEvents()}function b(b){return function(a){b.previewValue(a)}}
function f(b){return function(a){b.changeValue(a)}}var c=h("./autoComplete"),e=h("./Input"),d=h("./EventEmitter"),m=h("./Element");a.prototype=Object.create(d.prototype);a.prototype.toJSON=function(){return{name:this.name.toJSON(),operator:this.operator.toJSON(),value:this.value.toJSON()}};a.prototype.bindEvents=function(){var b=this;this.on("rendered",function(){b.name.emit("rendered");b.operator.emit("rendered");b.value.emit("rendered")});[this.name,this.operator,this.value].forEach(function(a){a.on("focus",
function(){b.emit("focus");b.$.removeClass("error").addClass("selected")}).on("blur",function(){b.emit("blur");b.$.removeClass("selected");b.validateInputs()}).on("change",function(){b.emit("change")})});this.bindName();this.bindOperator();this.bindValue()};a.prototype.bindName=function(){var a=this;this.name.on("nextInput",function(){a.operator.focus(0)}).on("prevInput",function(){a.emit("prevParameter")}).on("focus",function(){c(a.name.$,{appendTo:a.collection.$,datalist:a.collection.names}).on("hover",
b(a.name)).on("selected",f(a.name))}).on("blur",function(){c(a.name.$)})};a.prototype.bindOperator=function(){var a=this;this.operator.on("nextInput",function(){a.value.focus(0)}).on("prevInput",function(){a.name.focus()}).on("focus",function(){c(a.operator.$,{appendTo:a.collection.$,datalist:a.collection.opts.schema[a.name.$._.value].operators}).on("hover",b(a.operator)).on("selected",f(a.operator))}).on("blur",function(){c(a.operator.$)})};a.prototype.bindValue=function(){var a=this;this.value.on("nextInput",
function(){a.emit("nextParameter")}).on("prevInput",function(){a.operator.focus()}).on("focus",function(){if("text"===a.value.$._.type)c(a.value.$,{appendTo:a.collection.$,datalist:a.collection.opts.schema[a.name.$._.value].values}).on("hover",b(a.value)).on("selected",f(a.value))}).on("blur",function(){c(a.value.$)})};a.prototype.validateInputs=function(){var b=this.name.$._.value,a=this.operator.$._.value,c=this.value.$._.value;return(b+a+c).length?b.length&&a.length&&c.length?!0:(this.$.addClass("error"),
!1):(this.emit("remove"),!1)};return a}()},{"./Element":1,"./EventEmitter":2,"./Input":3,"./autoComplete":7}],5:[function(h,g,l){g.exports=function(){function a(a){a.on("focus",function(){d.$.addClass("selected")}).on("blur",function(){d.$.removeClass("selected")}).on("remove",function(){d.remove(a)}).on("change",function(){d.callback()}).on("prevParameter",function(b){(b=d.getPrev(a))&&b.value.focus()}).on("nextParameter",function(c){(c=d.getNext(a))?c.name.focus(0):d.insertAt(d.parameters.length,
new b(d),!0)})}var b=h("./Parameter"),f=h("./Element"),c=f("div",{"class":"placeholder"});c._.style.pointerEvents="none";var e=f("div",{"class":"parameters"}).append(c).on("mousedown",function(a){if(a.target===d.$._){a.preventDefault();var c=0;d.parameters.some(function(b,e){var d=b.$._.getBoundingClientRect(),f=document.body.scrollTop+d.top;if(a.pageY<d.top||f<a.pageY&&a.pageY<f+d.height&&d.left>a.pageX)return!0;c=e+1});d.insertAt(c,new b(d),!0)}}),d={parameters:[]};d.$=e;d.init=function(a){this.opts=
a;console.log(this.opts);c.text(a.placeholder||"");this.names=Object.keys(a.schema);this.opts.defaultQuery.forEach(function(a,c){d.insertAt(c,new b(d,a))});d.callback()};d.insertAt=function(b,d,f){c.hide();this.parameters[b]?e._.insertBefore(d.$._,this.parameters[b].$._):this.$.append(d.$);this.parameters.splice(b,0,d);a(d);f&&d.name.focus()};d.removeAt=function(a){a=this.parameters.splice(a,1);1===a.length&&a[0].$.remove();0===this.parameters.length&&c.show();d.callback()};d.remove=function(a,b){if(-1===
(b=this.parameters.indexOf(a)))return!1;this.removeAt(b)};d.getPrev=function(a,b){if(-1!==(b=this.parameters.indexOf(a)))return this.parameters[b-1]};d.getNext=function(a,b){if(-1!==(b=this.parameters.indexOf(a)))return this.parameters[b+1]};d.renderTo=function(a){f(a).append(this.$);this.parameters.forEach(function(a){a.emit("rendered")})};d.callback=function(){d.opts.callback(d.parameters.map(function(a){return a.toJSON()}))};return d}()},{"./Element":1,"./Parameter":4}],6:[function(h,g,l){window.VisualQuery=
function(a,b){var f=document.querySelector(a),c=Object.create({strict:!1,schema:[],defaultQuery:[],placeholder:"",callback:function(){}}),e;for(e in b)c[e]=b[e];e=h("./Parameters");e.init(c);e.renderTo(f)}},{"./Parameters":5}],7:[function(h,g,l){g.exports=function(){var a=h("./EventEmitter"),b=h("./Element"),f=b("ul",{"class":"autoComplete"}).css("position","absolute").hide(),c=function(){function c(a){k&&k.removeClass("selected");k=b(a).addClass("selected");p.emit("hover",k._.innerText)}function d(){for(var a=
0,b=0;b<n.length;b++)n[b]._.innerText.match(new RegExp(this.value,"i"))?n[b].show():(n[b].hide(),a++);a===n.length?f.hide():f.show()}function g(a){if(38===a.keyCode){var b;k&&k.shown()&&(b=k.prev())&&b.shown()&&(a.preventDefault(),c(b))}if(40===a.keyCode)if(k&&k.shown()){var d;(d=k.next())&&d.shown()&&(a.preventDefault(),c(d))}else for(b=0;b<n.length;b++)if(n[b].shown()){a.preventDefault();c(n[b]);break}13===a.keyCode&&(k&&k.shown()?p.emit("selected",k.text(),k.attr("value")):p.emit("selected"))}
function h(a,d){var f=b("li",{text:a}).on("mouseover",function(){c(this)}).on("mousedown",function(a){a.preventDefault()}).on("mouseup",function(){k&&k.shown()&&p.emit("selected",k.text(),k.attr("value"))});d&&f.attr("value",d);return f}var l=null,p=null,n=[],k=null;return{setDatalist:function(a){n.splice(0);for(var b in a)n.push(h(a[b],!(a instanceof Array)&&b));f.html("").append(n);return this},listenTo:function(b){l&&(k=null,l.off("keydown",g).off("input",d));l=b;p=new a;l.on("keydown",g).on("input",
d);d.apply(l._);return p}}}();return function(a,b){if("INPUT"!==a._.tagName||"text"!==a.attr("type"))return Error("Autocomplete must be bound to an input-text element");if(!(b instanceof Object))return f.hide();if(!b.appendTo)return Error("The appendTo property is required to render the auto complete");b.appendTo.append(f);f.show().offset(a._.offsetTop+a._.offsetHeight+"px",a._.offsetLeft+"px");return c.setDatalist(b.datalist).listenTo(a)}}()},{"./Element":1,"./EventEmitter":2}],8:[function(h,g,l){g.exports=
function(){var a=this.value||this.attributes.placeholder&&this.attributes.placeholder.value||"",b=document.createElement("span");b.textContent=a;b.style.position="absolute";b.style.width="auto";b.style.visibility="hidden";b.style.whiteSpace="pre";var f=getComputedStyle(this);"fontSize fontFamily fontWeight fontStyle fontVariant wordSpacing letterSpacing textIndent textRendering textTransform".split(" ").forEach(function(a){b.style[a]=f[a]});this.parentNode.appendChild(b);this.style.width=(b.offsetWidth||
5)+1+"px";this.parentNode.removeChild(b)}},{}]},{},[6]);
